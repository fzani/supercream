<?xml version="1.0" encoding="utf-8"?>
<Report xmlns:rd="http://schemas.microsoft.com/SQLServer/reporting/reportdesigner" xmlns="http://schemas.microsoft.com/sqlserver/reporting/2008/01/reportdefinition">
  <DataSources>
    <DataSource Name="ProductsBoughtDataSource">
      <DataSourceReference>SCDataSource</DataSourceReference>
      <rd:DataSourceID>1a87d91e-8203-448f-bf7e-43d952ad074f</rd:DataSourceID>
    </DataSource>
  </DataSources>
  <DataSets>
    <DataSet Name="ProductsBoughtDataSet">
      <Fields>
        <Field Name="ProductDescription">
          <DataField>ProductDescription</DataField>
          <rd:TypeName>System.String</rd:TypeName>
        </Field>
        <Field Name="TotalCustomersWhoHaveBoughtAnythingOverPeriod">
          <DataField>TotalCustomersWhoHaveBoughtAnythingOverPeriod</DataField>
          <rd:TypeName>System.Int32</rd:TypeName>
        </Field>
        <Field Name="CustomersWhoHaveBoughtThisProduct">
          <DataField>CustomersWhoHaveBoughtThisProduct</DataField>
          <rd:TypeName>System.Int32</rd:TypeName>
        </Field>
        <Field Name="CustomersWhoHaveNotBoughtThisProduct">
          <DataField>CustomersWhoHaveNotBoughtThisProduct</DataField>
          <rd:TypeName>System.Int32</rd:TypeName>
        </Field>
        <Field Name="PercentageCustomersWhoHaveNotBoughtThisProduct">
          <DataField>PercentageCustomersWhoHaveNotBoughtThisProduct</DataField>
          <rd:TypeName>System.Decimal</rd:TypeName>
        </Field>
      </Fields>
      <Query>
        <DataSourceName>ProductsBoughtDataSource</DataSourceName>
        <CommandText>DECLARE @totalCustomers int, @customersWhoHaveBoughtThisProduct int, @description varchar(200), @productId int, @RecordCount int, @ParamResult varchar(max) 
DECLARE @productIdList TABLE (id int) DECLARE @CustomerCoverageTable TABLE (ProductDescription varchar(max), TotalCustomersWhoHaveBoughtAnythingOverPeriod int, 
CustomersWhoHaveBoughtThisProduct int, CustomersWhoHaveNotBoughtThisProduct int, PercentageCustomersWhoHaveNotBoughtThisProduct decimal(10, 2)) 
/*-------------------------------------------------------------------------------*/ IF @p_ProductIdList IS NOT NULL BEGIN
SET                @RecordCount = 1
SET                @ParamResult = dbo.RPT_GetColonDelimitedParamItem(@p_ProductIdList, @RecordCount) WHILE @ParamResult IS NOT NULL BEGIN
                             INSERT        
                              INTO               @productIdList (id)
VALUES        (@ParamResult)
SET                @RecordCount = @RecordCount + 1
SET                @ParamResult = dbo.RPT_GetColonDelimitedParamItem(@p_ProductIdList, @RecordCount) 
                         END END /*-------------------------------------------------------------------------------*/ DECLARE @AllCustomers TABLE (CustomerId int)
                             INSERT        
                              INTO               @AllCustomers
                                                           SELECT DISTINCT (c.ID)
                                                            FROM            OrderHeader oh INNER JOIN
                                                                                     Customer c ON oh.CustomerID = c.id 
				where oh.invoicedate between @StartDate and @EndDate

                                                                                         SELECT        @totalCustomers = COUNT(*)
                                                                                          FROM            @AllCustomers /*-----------------------------------------------------------------------------------*/ DECLARE productCursor CURSOR FOR
                                                                                                                       SELECT        id
                                                                                                                        FROM            @productIdList; OPEN productCursor; FETCH next
                              FROM            productCursor
INTO              @productId; WHILE @@FETCH_STATUS = 0 BEGIN
                             SELECT        @customersWhoHaveBoughtThisProduct = count(DISTINCT (c.id))
                              FROM            [SuperCreamDB].[dbo].[OrderHeader] oh INNER JOIN
                                                       orderline ol ON oh.ID = ol.OrderID INNER JOIN
                                                       Product p ON ol.ProductID = p.ID INNER JOIN
                                                       Customer c ON oh.CustomerID = c.ID
                              WHERE        p.ID = @productId and
			(oh.invoicedate between @StartDate and @EndDate)

                                                           INSERT        
                                                            INTO               @CustomerCoverageTable
                                                                                         SELECT        (SELECT        p.Description
                                                                                                                     FROM            Product p
                                                                                                                     WHERE        p.id = @productId) AS ProductDescription, 
                                                                                                                   @totalCustomers AS TotalCustomersWhoHaveBoughtAnythingOverPeriod, 
                                                                                                                   @customersWhoHaveBoughtThisProduct AS CustomersWhoHaveBoughtThisProduct, 
                                                                                                                   @totalCustomers - @customersWhoHaveBoughtThisProduct AS CustomersWhoHaveNotBoughtThisProduct, 
                                                                                                                   round((100.0 / @totalCustomers) * (@totalCustomers - @customersWhoHaveBoughtThisProduct), 2) 
                                                                                                                   AS PercentageCustomersWhoHaveNotBoughtThisProduct FETCH next
                                                                                          FROM            productCursor
INTO              @productId; PRINT @productId END; CLOSE productCursor; DEALLOCATE productCursor;
                             /*---------------------------------------------------------------------------------------------*/ 

SELECT *
                              FROM            @CustomerCoverageTable
order by ProductDescription</CommandText>
        <QueryParameters>
          <QueryParameter Name="@p_ProductIdList">
            <Value>=Join(Parameters!p_ProductIdList.Value,":")</Value>
          </QueryParameter>
          <QueryParameter Name="@StartDate">
            <Value>=Parameters!StartDate.Value</Value>
          </QueryParameter>
          <QueryParameter Name="@EndDate">
            <Value>=Parameters!EndDate.Value</Value>
          </QueryParameter>
        </QueryParameters>
      </Query>
    </DataSet>
    <DataSet Name="ProductQuery">
      <Fields>
        <Field Name="ID">
          <DataField>ID</DataField>
          <rd:TypeName>System.Int32</rd:TypeName>
        </Field>
        <Field Name="Description">
          <DataField>Description</DataField>
          <rd:TypeName>System.String</rd:TypeName>
        </Field>
      </Fields>
      <Query>
        <DataSourceName>ProductsBoughtDataSource</DataSourceName>
        <CommandText>SELECT        ID, Description
FROM            Product</CommandText>
      </Query>
    </DataSet>
  </DataSets>
  <Body>
    <ReportItems>
      <Tablix Name="Tablix1">
        <TablixBody>
          <TablixColumns>
            <TablixColumn>
              <Width>1.74467in</Width>
            </TablixColumn>
            <TablixColumn>
              <Width>0.98425in</Width>
            </TablixColumn>
            <TablixColumn>
              <Width>2.21342in</Width>
            </TablixColumn>
            <TablixColumn>
              <Width>2.328in</Width>
            </TablixColumn>
            <TablixColumn>
              <Width>1.63008in</Width>
            </TablixColumn>
          </TablixColumns>
          <TablixRows>
            <TablixRow>
              <Height>0.23622in</Height>
              <TablixCells>
                <TablixCell>
                  <CellContents>
                    <Textbox Name="Textbox1">
                      <CanGrow>true</CanGrow>
                      <KeepTogether>true</KeepTogether>
                      <Paragraphs>
                        <Paragraph>
                          <TextRuns>
                            <TextRun>
                              <Value>Product Description</Value>
                              <Style>
                                <FontSize>12pt</FontSize>
                                <FontWeight>Bold</FontWeight>
                                <Color>White</Color>
                              </Style>
                            </TextRun>
                          </TextRuns>
                          <Style />
                        </Paragraph>
                      </Paragraphs>
                      <rd:DefaultName>Textbox1</rd:DefaultName>
                      <Style>
                        <Border>
                          <Color>LightGrey</Color>
                          <Style>Solid</Style>
                        </Border>
                        <BackgroundColor>CornflowerBlue</BackgroundColor>
                        <PaddingLeft>2pt</PaddingLeft>
                        <PaddingRight>2pt</PaddingRight>
                        <PaddingTop>2pt</PaddingTop>
                        <PaddingBottom>2pt</PaddingBottom>
                      </Style>
                    </Textbox>
                  </CellContents>
                </TablixCell>
                <TablixCell>
                  <CellContents>
                    <Textbox Name="Textbox3">
                      <CanGrow>true</CanGrow>
                      <KeepTogether>true</KeepTogether>
                      <Paragraphs>
                        <Paragraph>
                          <TextRuns>
                            <TextRun>
                              <Value>Total Customers Who Have Bought Anything Over Period</Value>
                              <Style>
                                <FontSize>12pt</FontSize>
                                <FontWeight>Bold</FontWeight>
                                <Color>White</Color>
                              </Style>
                            </TextRun>
                          </TextRuns>
                          <Style />
                        </Paragraph>
                      </Paragraphs>
                      <rd:DefaultName>Textbox3</rd:DefaultName>
                      <Style>
                        <Border>
                          <Color>LightGrey</Color>
                          <Style>Solid</Style>
                        </Border>
                        <BackgroundColor>CornflowerBlue</BackgroundColor>
                        <PaddingLeft>2pt</PaddingLeft>
                        <PaddingRight>2pt</PaddingRight>
                        <PaddingTop>2pt</PaddingTop>
                        <PaddingBottom>2pt</PaddingBottom>
                      </Style>
                    </Textbox>
                  </CellContents>
                </TablixCell>
                <TablixCell>
                  <CellContents>
                    <Textbox Name="Textbox5">
                      <CanGrow>true</CanGrow>
                      <KeepTogether>true</KeepTogether>
                      <Paragraphs>
                        <Paragraph>
                          <TextRuns>
                            <TextRun>
                              <Value>Customers Who Have Bought This Product</Value>
                              <Style>
                                <FontSize>12pt</FontSize>
                                <FontWeight>Bold</FontWeight>
                                <Color>White</Color>
                              </Style>
                            </TextRun>
                          </TextRuns>
                          <Style />
                        </Paragraph>
                      </Paragraphs>
                      <rd:DefaultName>Textbox5</rd:DefaultName>
                      <Style>
                        <Border>
                          <Color>LightGrey</Color>
                          <Style>Solid</Style>
                        </Border>
                        <BackgroundColor>CornflowerBlue</BackgroundColor>
                        <PaddingLeft>2pt</PaddingLeft>
                        <PaddingRight>2pt</PaddingRight>
                        <PaddingTop>2pt</PaddingTop>
                        <PaddingBottom>2pt</PaddingBottom>
                      </Style>
                    </Textbox>
                  </CellContents>
                </TablixCell>
                <TablixCell>
                  <CellContents>
                    <Textbox Name="Textbox7">
                      <CanGrow>true</CanGrow>
                      <KeepTogether>true</KeepTogether>
                      <Paragraphs>
                        <Paragraph>
                          <TextRuns>
                            <TextRun>
                              <Value>Customers Who Have Not Bought This Product</Value>
                              <Style>
                                <FontSize>12pt</FontSize>
                                <FontWeight>Bold</FontWeight>
                                <Color>White</Color>
                              </Style>
                            </TextRun>
                          </TextRuns>
                          <Style />
                        </Paragraph>
                      </Paragraphs>
                      <rd:DefaultName>Textbox7</rd:DefaultName>
                      <Style>
                        <Border>
                          <Color>LightGrey</Color>
                          <Style>Solid</Style>
                        </Border>
                        <BackgroundColor>CornflowerBlue</BackgroundColor>
                        <PaddingLeft>2pt</PaddingLeft>
                        <PaddingRight>2pt</PaddingRight>
                        <PaddingTop>2pt</PaddingTop>
                        <PaddingBottom>2pt</PaddingBottom>
                      </Style>
                    </Textbox>
                  </CellContents>
                </TablixCell>
                <TablixCell>
                  <CellContents>
                    <Textbox Name="Textbox9">
                      <CanGrow>true</CanGrow>
                      <KeepTogether>true</KeepTogether>
                      <Paragraphs>
                        <Paragraph>
                          <TextRuns>
                            <TextRun>
                              <Value>Percentage Customers Who Have Not Bought This Product</Value>
                              <Style>
                                <FontSize>12pt</FontSize>
                                <FontWeight>Bold</FontWeight>
                                <Color>White</Color>
                              </Style>
                            </TextRun>
                          </TextRuns>
                          <Style />
                        </Paragraph>
                      </Paragraphs>
                      <rd:DefaultName>Textbox9</rd:DefaultName>
                      <Style>
                        <Border>
                          <Color>LightGrey</Color>
                          <Style>Solid</Style>
                        </Border>
                        <BackgroundColor>CornflowerBlue</BackgroundColor>
                        <PaddingLeft>2pt</PaddingLeft>
                        <PaddingRight>2pt</PaddingRight>
                        <PaddingTop>2pt</PaddingTop>
                        <PaddingBottom>2pt</PaddingBottom>
                      </Style>
                    </Textbox>
                  </CellContents>
                </TablixCell>
              </TablixCells>
            </TablixRow>
            <TablixRow>
              <Height>0.23622in</Height>
              <TablixCells>
                <TablixCell>
                  <CellContents>
                    <Textbox Name="ProductDescription">
                      <CanGrow>true</CanGrow>
                      <KeepTogether>true</KeepTogether>
                      <Paragraphs>
                        <Paragraph>
                          <TextRuns>
                            <TextRun>
                              <Value>=Fields!ProductDescription.Value</Value>
                              <Style />
                            </TextRun>
                          </TextRuns>
                          <Style />
                        </Paragraph>
                      </Paragraphs>
                      <rd:DefaultName>ProductDescription</rd:DefaultName>
                      <Style>
                        <Border>
                          <Color>#eaeaea</Color>
                          <Style>Solid</Style>
                        </Border>
                        <PaddingLeft>5pt</PaddingLeft>
                        <PaddingRight>5pt</PaddingRight>
                        <PaddingTop>5pt</PaddingTop>
                        <PaddingBottom>5pt</PaddingBottom>
                      </Style>
                    </Textbox>
                  </CellContents>
                </TablixCell>
                <TablixCell>
                  <CellContents>
                    <Textbox Name="TotalCustomersWhoHaveBoughtAnythingOverPeriod">
                      <CanGrow>true</CanGrow>
                      <KeepTogether>true</KeepTogether>
                      <Paragraphs>
                        <Paragraph>
                          <TextRuns>
                            <TextRun>
                              <Value>=Fields!TotalCustomersWhoHaveBoughtAnythingOverPeriod.Value</Value>
                              <Style />
                            </TextRun>
                          </TextRuns>
                          <Style>
                            <TextAlign>Center</TextAlign>
                          </Style>
                        </Paragraph>
                      </Paragraphs>
                      <rd:DefaultName>TotalCustomersWhoHaveBoughtAnythingOverPeriod</rd:DefaultName>
                      <Style>
                        <Border>
                          <Color>#eaeaea</Color>
                          <Style>Solid</Style>
                        </Border>
                        <PaddingLeft>2pt</PaddingLeft>
                        <PaddingRight>2pt</PaddingRight>
                        <PaddingTop>2pt</PaddingTop>
                        <PaddingBottom>2pt</PaddingBottom>
                      </Style>
                    </Textbox>
                  </CellContents>
                </TablixCell>
                <TablixCell>
                  <CellContents>
                    <Textbox Name="CustomersWhoHaveBoughtThisProduct">
                      <CanGrow>true</CanGrow>
                      <KeepTogether>true</KeepTogether>
                      <Paragraphs>
                        <Paragraph>
                          <TextRuns>
                            <TextRun>
                              <Value>=Fields!CustomersWhoHaveBoughtThisProduct.Value</Value>
                              <Style />
                            </TextRun>
                          </TextRuns>
                          <Style>
                            <TextAlign>Center</TextAlign>
                          </Style>
                        </Paragraph>
                      </Paragraphs>
                      <rd:DefaultName>CustomersWhoHaveBoughtThisProduct</rd:DefaultName>
                      <Style>
                        <Border>
                          <Color>#eaeaea</Color>
                          <Style>Solid</Style>
                        </Border>
                        <PaddingLeft>2pt</PaddingLeft>
                        <PaddingRight>2pt</PaddingRight>
                        <PaddingTop>2pt</PaddingTop>
                        <PaddingBottom>2pt</PaddingBottom>
                      </Style>
                    </Textbox>
                  </CellContents>
                </TablixCell>
                <TablixCell>
                  <CellContents>
                    <Textbox Name="CustomersWhoHaveNotBoughtThisProduct">
                      <CanGrow>true</CanGrow>
                      <KeepTogether>true</KeepTogether>
                      <Paragraphs>
                        <Paragraph>
                          <TextRuns>
                            <TextRun>
                              <Value>=Fields!CustomersWhoHaveNotBoughtThisProduct.Value</Value>
                              <Style />
                            </TextRun>
                          </TextRuns>
                          <Style>
                            <TextAlign>Center</TextAlign>
                          </Style>
                        </Paragraph>
                      </Paragraphs>
                      <rd:DefaultName>CustomersWhoHaveNotBoughtThisProduct</rd:DefaultName>
                      <Style>
                        <Border>
                          <Color>#eaeaea</Color>
                          <Style>Solid</Style>
                        </Border>
                        <PaddingLeft>2pt</PaddingLeft>
                        <PaddingRight>2pt</PaddingRight>
                        <PaddingTop>2pt</PaddingTop>
                        <PaddingBottom>2pt</PaddingBottom>
                      </Style>
                    </Textbox>
                  </CellContents>
                </TablixCell>
                <TablixCell>
                  <CellContents>
                    <Textbox Name="PercentageCustomersWhoHaveNotBoughtThisProduct">
                      <CanGrow>true</CanGrow>
                      <KeepTogether>true</KeepTogether>
                      <Paragraphs>
                        <Paragraph>
                          <TextRuns>
                            <TextRun>
                              <Value>=Fields!PercentageCustomersWhoHaveNotBoughtThisProduct.Value / 100.0</Value>
                              <Style>
                                <Format>0.00%</Format>
                              </Style>
                            </TextRun>
                          </TextRuns>
                          <Style>
                            <TextAlign>Center</TextAlign>
                          </Style>
                        </Paragraph>
                      </Paragraphs>
                      <rd:DefaultName>PercentageCustomersWhoHaveNotBoughtThisProduct</rd:DefaultName>
                      <Style>
                        <Border>
                          <Color>#eaeaea</Color>
                          <Style>Solid</Style>
                        </Border>
                        <PaddingLeft>2pt</PaddingLeft>
                        <PaddingRight>2pt</PaddingRight>
                        <PaddingTop>2pt</PaddingTop>
                        <PaddingBottom>2pt</PaddingBottom>
                      </Style>
                    </Textbox>
                  </CellContents>
                </TablixCell>
              </TablixCells>
            </TablixRow>
          </TablixRows>
        </TablixBody>
        <TablixColumnHierarchy>
          <TablixMembers>
            <TablixMember />
            <TablixMember />
            <TablixMember />
            <TablixMember />
            <TablixMember />
          </TablixMembers>
        </TablixColumnHierarchy>
        <TablixRowHierarchy>
          <TablixMembers>
            <TablixMember>
              <KeepWithGroup>After</KeepWithGroup>
            </TablixMember>
            <TablixMember>
              <Group Name="Details" />
            </TablixMember>
          </TablixMembers>
        </TablixRowHierarchy>
        <DataSetName>ProductsBoughtDataSet</DataSetName>
        <Top>2.79612cm</Top>
        <Height>1.2cm</Height>
        <Width>22.60708cm</Width>
        <Style>
          <Border>
            <Style>None</Style>
          </Border>
        </Style>
      </Tablix>
      <Textbox Name="textbox1">
        <CanGrow>true</CanGrow>
        <KeepTogether>true</KeepTogether>
        <Paragraphs>
          <Paragraph>
            <TextRuns>
              <TextRun>
                <Value>Products Bought by Customers</Value>
                <Style>
                  <FontSize>16pt</FontSize>
                  <FontWeight>Bold</FontWeight>
                </Style>
              </TextRun>
            </TextRuns>
            <LeftIndent>0cm</LeftIndent>
            <HangingIndent>0cm</HangingIndent>
            <Style />
          </Paragraph>
        </Paragraphs>
        <rd:DefaultName>textbox1</rd:DefaultName>
        <Top>0.36301cm</Top>
        <Height>0.36in</Height>
        <Width>4.57291in</Width>
        <ZIndex>1</ZIndex>
        <Style>
          <PaddingLeft>2pt</PaddingLeft>
          <PaddingRight>2pt</PaddingRight>
          <PaddingTop>2pt</PaddingTop>
          <PaddingBottom>2pt</PaddingBottom>
        </Style>
      </Textbox>
      <Textbox Name="Textbox6">
        <CanGrow>true</CanGrow>
        <KeepTogether>true</KeepTogether>
        <Paragraphs>
          <Paragraph>
            <TextRuns>
              <TextRun>
                <Value>The folllowing Report details Sales by Delivery Date. Dates ranges selected, reflect Delivery Dates for Products.</Value>
                <Style>
                  <FontStyle>Italic</FontStyle>
                </Style>
              </TextRun>
            </TextRuns>
            <Style />
          </Paragraph>
        </Paragraphs>
        <rd:DefaultName>Textbox6</rd:DefaultName>
        <Top>0.57236in</Top>
        <Height>0.40625in</Height>
        <Width>5.80542in</Width>
        <ZIndex>2</ZIndex>
        <Style>
          <Border>
            <Style>None</Style>
          </Border>
          <PaddingLeft>2pt</PaddingLeft>
          <PaddingRight>2pt</PaddingRight>
          <PaddingTop>2pt</PaddingTop>
          <PaddingBottom>2pt</PaddingBottom>
        </Style>
      </Textbox>
    </ReportItems>
    <Height>1.57327in</Height>
    <Style />
  </Body>
  <ReportParameters>
    <ReportParameter Name="p_ProductIdList">
      <DataType>String</DataType>
      <Prompt>Products</Prompt>
      <ValidValues>
        <DataSetReference>
          <DataSetName>ProductQuery</DataSetName>
          <ValueField>ID</ValueField>
          <LabelField>Description</LabelField>
        </DataSetReference>
      </ValidValues>
      <MultiValue>true</MultiValue>
    </ReportParameter>
    <ReportParameter Name="StartDate">
      <DataType>DateTime</DataType>
      <Prompt>Invoice Start Date</Prompt>
    </ReportParameter>
    <ReportParameter Name="EndDate">
      <DataType>DateTime</DataType>
      <Prompt>End Invoice Date</Prompt>
    </ReportParameter>
  </ReportParameters>
  <Width>8.90043in</Width>
  <Page>
    <PageHeight>29.7cm</PageHeight>
    <PageWidth>21cm</PageWidth>
    <LeftMargin>2cm</LeftMargin>
    <RightMargin>2cm</RightMargin>
    <TopMargin>2cm</TopMargin>
    <BottomMargin>2cm</BottomMargin>
    <ColumnSpacing>0.13cm</ColumnSpacing>
    <Style />
  </Page>
  <Language>en-GB</Language>
  <rd:ReportID>73d5b9aa-0d5e-4d86-949c-ab4dedbfab5c</rd:ReportID>
  <rd:ReportUnitType>Cm</rd:ReportUnitType>
</Report>